# Isolated Sandboxes

**Назначение:** Быстро и удобно создавать частично-изолированные песочницы для запуска ненадёжного кода (например, AI-агентов). Проект нацелен на минимизацию риска повреждения хоста и пользовательских данных при одновременной сохранности удобства использования.

Основная идея
- Главный файл проекта — [.justfile](.justfile). В нём находятся все рецепты управления: сборка образа, создание контейнера, настройка окружения и запуск пользовательских скриптов внутри песочницы.
- Рабочий поток: `just box name`. Рецепты создают директорию в `sandboxes/`, запускают контейнер с настройками неймспейсов и ресурсов, выполняют `setup.sh` внутри контейнера под непривилегированным пользователем.

Быстрый старт (рекомендуемые команды)

```bash
just build-base     # собрать базовый образ (podman)
just box name       # создать/запустить и войти в песочницу (замените name)
just ls             # список песочниц
just rm name        # удалить песочницу
```

Ключевые файлы
- [.justfile](.justfile) — главный сценарий управления песочницами.
- [Containerfile](Containerfile) — Docker/Podman образ, используемый как база.
- [setup.sh](setup.sh) — пользовательский скрипт, выполняется внутри контейнера для начальной настройки окружения.
- `sandboxes/` — директория для данных экземпляров.

Безопасность и ограничения
- Цель — частичная изоляция: используются приёмы вроде `--userns=keep-id`, ограничений ресурсов, tmpfs для `XDG_RUNTIME_DIR` и выполнение пользовательских шагов от непривилегированного пользователя внутри контейнера.
- Однако текущие параметры в `.justfile` (например, `--net=host`, `--ipc=host`, проброс устройств) уменьшают степень изоляции. Это сделано для удобства и совместимости (графика, звук, IPC), но снижает гарантию непричинения вреда хосту.
- Рекомендация: перед использованием с критичными задачами проверьте и при необходимости измените флаги в [.justfile](.justfile) (убрать `--net=host`, `--ipc=host`, ограничить устройства и т.п.).

Рекомендации по использованию
- Запускайте каждого AI-агента в отдельной песочнице для ограничения blast radius.
- Не храните секреты в `sandboxes/`.
- Просматривайте `.justfile` и `setup.sh` перед запуском.
